<% require_relative 'erb/helpers.rb' %>
<% Helpers.iterate_kafka_broker_list %>
---
Organizations:
  - &OrdererOrg
    Name: OrdererOrg
    ID: OrdererMSP
    MSPDir: crypto-config/ordererOrganizations/<% @namespace %>.com/msp
    AdminPrincipal: Role.MEMBER
<% @organizations.each do |organization| %>
<% @organization_name = organization.keys.first %>
  - &<% @organization_name %>
    Name: <% @organization_name %>MSP
    ID: <% @organization_name %>MSP
    MSPDir: crypto-config/peerOrganizations/<% @organization_name %>.<% @namespace %>.com/msp
    AdminPrincipal: Role.MEMBER
    AnchorPeers:
<% organization.values.first.each do |peer| %>
<% @peer_name = peer.keys.first %>
<% Helpers.load_peer_template_vars(peer.values.first) %>
      - Host: <% @peer_name %>
        Port: 30110
<% end %>
<% end %>
<% @orderers.each do |orderer| %>
<% @orderer_name = orderer.keys.first %>
<% Helpers.load_orderer_template_vars(orderer.values.first) %>
Orderer: &OrdererDefaults
  OrdererType: kafka
  Addresses:
    - <% @CONFIGTX_ORDERER_ADDRESSES %>
  BatchTimeout: 1s
  BatchSize:
    MaxMessageCount: 50
    AbsoluteMaxBytes: 99 MB
    PreferredMaxBytes: 512 KB
  Kafka:
    Brokers:
<% @brokers_list.each do |broker| %>
      - <% broker %>
<% end %>
  Organizations:
<% end %>
Application: &ApplicationDefaults
  Organizations:
Profiles:
  OrgsOrdererGenesis:
    Orderer:
      <<: *OrdererDefaults
      Organizations:
        - *OrdererOrg
    Consortiums:
      SampleConsortium:
        Organizations:
<% @organizations.each do |organization| %>
          - <% organization.keys.first %>
<% end %>
  OrgsChannel:
    Consortium: <% @consortium_name %>
    Application:
      <<: *ApplicationDefaults
      Organizations:
<% @organizations.each do |organization| %>
        - <% organization.keys.first %>
<% end %>